<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>4äººã‚µã‚¤ã‚³ãƒ­ã‚²ãƒ¼ãƒ  å®Œå…¨ç‰ˆï¼ˆçµŒæ¸ˆå¤‰å‹•ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè£…ï¼‰</title>
<style>
:root{
  --bg:#7bd24a; --card:#fff; --muted:#666; --shadow:0 8px 20px rgba(0,0,0,0.18);
}
/* èƒŒæ™¯è‰²ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
body{height:100%;margin:0;font-family:"Helvetica Neue",Arial,sans-serif;background:var(--bg); transition: background 1s ease;}

.wrap{max-width:1100px;margin:0 auto;padding:18px;display:flex;flex-direction:column;min-height:100%;}
.players{display:flex;gap:10px;justify-content:space-between;margin-bottom:12px;}
.player{flex:1;padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#f0f0f0);box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;transition:transform .18s;text-align:center;}
.player.current{outline:4px solid rgba(0,0,0,0.06);transform:translateY(-6px);}
.player .name{font-weight:800;margin-bottom:6px;}
.player .meta{font-size:13px;color:var(--muted);}
.player .buff{margin-top:8px;color:#b12727;font-weight:700;}
.player.lost{opacity:0.4;text-decoration:line-through;}
.p1{background:linear-gradient(180deg,#ffd6d6,#fff);}
.p2{background:linear-gradient(180deg,#d6e4ff,#fff);}
.p3{background:linear-gradient(180deg,#d6ffd9,#fff);}
.p4{background:linear-gradient(180deg,#fff6d6,#fff);}
.main-grid{display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start;}
.board{display:flex;flex-direction:column;align-items:center;padding:12px;}
.dice-box{width:260px;height:160px;border-radius:14px;background:var(--card);box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;position:relative;}
.dice-images{display:flex;gap:10px;align-items:center;justify-content:center;}
.dice-images img{width:80px;height:80px;object-fit:contain;transition:transform .45s ease;}
.controls{display:flex;gap:12px;align-items:center;margin-top:14px;flex-wrap:wrap;justify-content:center;}
.num-control{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.95);padding:8px 12px;border-radius:10px;box-shadow:var(--shadow);}
.icon-btn{width:44px;height:44px;border-radius:8px;border:0;background:#f3f3f3;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.big-btn{height:48px;padding:0 20px;border-radius:12px;border:0;background:#fff;font-weight:800;box-shadow:var(--shadow);cursor:pointer;}
/* ã‚·ãƒ§ãƒƒãƒ—ãƒœã‚¿ãƒ³ */
.shop-btn{background:#9c27b0; color:#fff;} 
.event-card{border-radius:12px;background:linear-gradient(180deg,#fff8d9,#fff);box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;padding:14px;font-size:16px;color:#222;transition:transform .25s,opacity .25s;}
.event-card.hidden{opacity:0;transform:translateY(12px);pointer-events:none;}
.event-label{font-weight:800;margin-right:10px;color:#b27b00;}
.event-sub{font-size:14px;color:var(--muted);}
.money-panel{background:linear-gradient(180deg,#fff,#f7f7f7);border-radius:12px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px;}
.person-money{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;}
.name-input{border-radius:8px;border:1px solid #ddd;padding:6px 8px;font-weight:700;}
.total{font-size:18px;font-weight:800;margin-top:6px;}
.color-bar{width:14px;height:48px;border-radius:6px;margin-right:6px;}
.money-buttons{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px;}
.money-buttons button{padding:4px 8px;border-radius:6px;border:0;background:#f0f0f0;font-weight:700;cursor:pointer;transition:0.2s;}
.money-buttons button:hover{background:#ddd;}
#quiz-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.65);display:none;align-items:center;justify-content:center;z-index:999;}
#quiz-box{background:#fff;padding:24px;border-radius:16px;max-width:600px;width:90%;text-align:center;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
#quiz-box h2{margin-bottom:16px;font-size:20px;}
#quiz-options{display:flex;flex-direction:column;gap:10px;margin-top:12px;}
#quiz-options button{padding:12px;border-radius:10px;border:0;background:#f0f0f0;font-weight:700;cursor:pointer;transition:0.2s;}
#quiz-options button:hover{background:#ddd;}
#quiz-result{margin-top:16px;font-weight:800;font-size:18px;}
#quiz-ok{margin-top:16px;padding:10px 20px;border-radius:12px;border:0;background:#4CAF50;color:#fff;font-weight:800;cursor:pointer;display:none;}
#winner-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.65);display:none;align-items:center;justify-content:center;z-index:1000;}
#winner-box{background:#fff;padding:32px;border-radius:16px;max-width:500px;width:90%;text-align:center;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
#winner-box h2{font-size:28px;margin-bottom:16px;}
#winner-box button{padding:12px 20px;border-radius:12px;border:0;background:#4CAF50;color:#fff;font-weight:800;cursor:pointer;}

/* ã‚·ãƒ§ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨CSS */
#shop-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.65);display:none;align-items:center;justify-content:center;z-index:999;}
#shop-box{background:#fff;padding:24px;border-radius:16px;max-width:600px;width:90%;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
#shop-box h2{margin-bottom:16px;font-size:20px; text-align:center; color:#9c27b0;}
.shop-list{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
.shop-item{border:2px solid #eee; border-radius:10px; padding:10px; display:flex; flex-direction:column; align-items:center; text-align:center;}
.shop-item h3{margin:5px 0; font-size:16px;}
.shop-item p{font-size:12px; color:#666; height:30px;}
.shop-price{font-weight:800; color:#e91e63; margin-bottom:8px;}
.shop-buy-btn{padding:8px 16px; border-radius:8px; border:none; background:#9c27b0; color:#fff; font-weight:700; cursor:pointer;}
.shop-buy-btn:disabled{background:#ccc; cursor:not-allowed;}
#shop-close{margin-top:16px; width:100%; padding:10px; border-radius:10px; border:none; background:#666; color:#fff; font-weight:700; cursor:pointer;}
.target-btn{background:#e91e63; margin-top:5px; padding:10px; border-radius:8px; border:none; color:#fff; font-weight:700; cursor:pointer; width:100%;}

/* çµŒæ¸ˆçŠ¶æ³è¡¨ç¤ºãƒ‘ãƒãƒ« */
#economy-panel {
  background: rgba(255,255,255,0.9);
  padding: 8px 16px;
  border-radius: 20px;
  margin-bottom: 10px;
  text-align: center;
  font-weight: bold;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  border: 2px solid #333;
}
#economy-icon { font-size: 24px; }
</style>
</head>
<body>
<div class="wrap">

  <div id="economy-panel">
    <span id="economy-icon">â˜€ï¸</span>
    <span id="economy-text">çµŒæ¸ˆçŠ¶æ³: å¹³ç©</span>
  </div>

<div class="players" id="players">
  <div class="player p1 current" id="pl-1"><div class="name" id="plname-0">Player 1</div><div class="meta">è‰²: èµ¤</div><div class="buff" id="buff-1"></div></div>
  <div class="player p2" id="pl-2"><div class="name" id="plname-1">Player 2</div><div class="meta">è‰²: é’</div><div class="buff" id="buff-2"></div></div>
  <div class="player p3" id="pl-3"><div class="name" id="plname-2">Player 3</div><div class="meta">è‰²: ç·‘</div><div class="buff" id="buff-3"></div></div>
  <div class="player p4" id="pl-4"><div class="name" id="plname-3">Player 4</div><div class="meta">è‰²: é»„</div><div class="buff" id="buff-4"></div></div>
</div>

<div class="main-grid">
  <section class="board">
    <div class="dice-box" aria-live="polite">
      <div class="dice-images" id="dice-area"></div>
    </div>
    <div style="margin-top:10px">ç¾åœ¨ã®ç•ª: <strong id="turn-name">Player 1</strong></div>
    <div class="controls" style="margin-top:12px">
      <div class="num-control">
        <button class="icon-btn" id="dec">âˆ’</button>
        <div id="count" style="font-weight:800;font-size:20px">1</div>
        <button class="icon-btn" id="inc">+</button>
      </div>
      <button class="big-btn" id="rollBtn">ğŸ² ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
      <button class="big-btn" id="eventBtn">âš¡ ã‚¤ãƒ™ãƒ³ãƒˆé–‹å§‹</button>
      <button class="big-btn shop-btn" id="shopBtn">ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</button>
    </div>
    <div style="width:100%;max-width:520px;margin-top:14px">
      <div class="event-card hidden" id="event-card" role="status" aria-live="polite">
        <div>
          <div class="event-label" id="event-label">ã‚¤ãƒ™ãƒ³ãƒˆ</div>
          <div class="event-sub" id="event-text">ã“ã“ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
      </div>
    </div>
    <div style="margin-top:12px">
      <button class="big-btn" id="endBtn">ã‚¿ãƒ¼ãƒ³çµ‚äº† â†’ æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸</button>
    </div>
  </section>

  <aside class="money-panel"></aside>
</div>

<div id="shop-modal">
  <div id="shop-box">
    <h2 id="shop-title">ã‚¢ã‚¤ãƒ†ãƒ ã‚·ãƒ§ãƒƒãƒ—</h2>
    <div class="shop-list" id="shop-list"></div>
    <button id="shop-close">é–‰ã˜ã‚‹</button>
  </div>
</div>

<div id="quiz-modal">
  <div id="quiz-box">
    <h2 id="quiz-question">å•é¡Œ</h2>
    <div id="quiz-options"></div>
    <div id="quiz-result"></div>
    <button id="quiz-ok">OK</button>
  </div>
</div>

<div id="winner-modal">
  <div id="winner-box">
    <h2 id="winner-text">ã€‡ã€‡ win!!</h2>
    <button id="restart-btn">æ¬¡ã®ã‚²ãƒ¼ãƒ ã¸</button>
  </div>
</div>

</div>

<script>
// çµŒæ¸ˆçŠ¶æ³å¤‰æ•°ã®è¿½åŠ 
let economyMode = 'normal'; // normal, inflation, deflation, burst

let diceCount = 1;
let currentPlayer = 0;
const players = [
  {name:"Player 1", total:1000, buff:0, skipTurn:0, reverse:0, pos:0, color:"#ff5858", lost:false},
  {name:"Player 2", total:1000, buff:0, skipTurn:0, reverse:0, pos:0, color:"#4da6ff", lost:false},
  {name:"Player 3", total:1000, buff:0, skipTurn:0, reverse:0, pos:0, color:"#7df07e", lost:false},
  {name:"Player 4", total:1000, buff:0, skipTurn:0, reverse:0, pos:0, color:"#ffd86b", lost:false}
];

const events = [
  "ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ãŸåˆ†æˆ»ã‚‹","ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ãŸåˆ†é€²ã‚€","æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚³ãƒ­1ã¤è¿½åŠ ",
  "å…¨éƒ¨ã®ã‚³ãƒã‚¹ã‚¿ãƒ¼ãƒˆã«æˆ»ã‚‹","ã‚³ãƒã‚’ï¼‘ã¤ã‚´ãƒ¼ãƒ«ã«é€²ã‚ã‚‹","æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã€é€²ã‚€ãƒã‚¹Ã—ï¼’",
  "ã‚‚ã†ä¸€å›è¡Œå‹•ã§ãã‚‹","1ã‚¿ãƒ¼ãƒ³ä¼‘ã¿","1ã‚¿ãƒ¼ãƒ³ã ã‘ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ”»æ’ƒå›é¿",
  "å¼·å¥ª(æ¬¡ç›¸æ‰‹ã‚’æ”»æ’ƒã—ãŸã¨ã$300ã‚‚ã‚‰ãˆã‚‹)","ä¸€äº¤æ›(å³éš£ã®äººã¨ã‚³ãƒã®å ´æ‰€äº¤æ›)","3ã‚¿ãƒ¼ãƒ³é€†èµ°",
  "æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚³ãƒ­3ã¤è¿½åŠ ","æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚³ãƒ­2ã¤è¿½åŠ ",
  "$1000ç²å¾—","$5000ç²å¾—","$800ç²å¾—","$3000ç²å¾—","$500ç²å¾—","$900ç²å¾—","$7000ç²å¾—",
  "$800å¤±ã†","$1000å¤±ã†","$500å¤±ã†","$900å¤±ã†","$200å¤±ã†","ã‚´ãƒ¼ãƒ«ã®ã‚³ãƒå¤±ã†","ã‚¯ã‚¤ã‚ºï¼"
];

const quizzes=[
  {q:"ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦ã§æ—¥æœ¬ãŒé™ä¼ã—ãŸå¹´ã¯ï¼Ÿ", options:["1944","1945","1946","1947"], answer:1},
  {q:"ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½ãŒå§‹ã¾ã£ãŸå¹´ã¯ï¼Ÿ", options:["1788","1789","1790","1791"], answer:1},
  {q:"æ—¥æœ¬å›½æ†²æ³•ã®æ–½è¡Œæ—¥ã¯ï¼Ÿ", options:["1945å¹´5æœˆ3æ—¥","1946å¹´5æœˆ3æ—¥","1947å¹´5æœˆ3æ—¥","1948å¹´5æœˆ3æ—¥"], answer:2},
  {q:"å…ƒç´  Feï¼ˆé‰„ï¼‰ã®é…¸åŒ–çŠ¶æ…‹ã§æœ€ã‚‚å®‰å®šã—ã¦ã„ã‚‹ã‚‚ã®ã¯ï¼Ÿ", options:["+1","+2","+3","+4"], answer:2},
  {q:"é«˜æ ¡ç”Ÿç‰©ã§ã€éºä¼æƒ…å ±ã‚’æ‹…ã†ç‰©è³ªã¯ï¼Ÿ", options:["ã‚¿ãƒ³ãƒ‘ã‚¯è³ª","RNA","DNA","è„‚è³ª"], answer:2},
  {q:"é…¸åŒ–é‚„å…ƒåå¿œã§é›»å­ã‚’å¤±ã†ã‚‚ã®ã¯ï¼Ÿ", options:["é…¸åŒ–å‰¤","é‚„å…ƒå‰¤","æ°´","é…¸ç´ "], answer:1},
  {q:"ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ã®æ³•å‰‡ã§ã€ç‰©ä½“ã«åŠ›ãŒåŠ ã‚ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ", options:["é€Ÿåº¦ãŒå¤‰ã‚ã‚‹","ä½ç½®ãŒå¤‰ã‚ã‚‹ã ã‘","è³ªé‡ãŒå¤‰ã‚ã‚‹","åŠ é€Ÿåº¦ã¯ä¸€å®š"], answer:0},
  {q:"sin30Â°ã®å€¤ã¯ï¼Ÿ", options:["1/2","âˆš2/2","âˆš3/2","1"], answer:0},
  {q:"å…‰ã®å±ˆæŠ˜ã§å…‰ãŒåª’è³ªã«å…¥ã‚‹ã¨ãé€Ÿåº¦ã¯ã©ã†ãªã‚‹ï¼Ÿ", options:["é€Ÿããªã‚‹","é…ããªã‚‹","å¤‰ã‚ã‚‰ãªã„","é€†æ–¹å‘ã«æ›²ãŒã‚‹"], answer:1},
  {q:"è‘‰ç·‘ä½“ã§èµ·ã“ã‚‹åå¿œã¯ï¼Ÿ", options:["å‘¼å¸","å…‰åˆæˆ","ç™ºé…µ","åˆ†è§£"], answer:1},
  {q:"DNAè¤‡è£½ã¯ç´°èƒå‘¨æœŸã®ã©ã®æ®µéšã§è¡Œã‚ã‚Œã‚‹ï¼Ÿ", options:["åˆ†è£‚æœŸ","é–“æœŸ","å‰æœŸ","å¾ŒæœŸ"], answer:1},
  {q:"æ—¥æœ¬ã®ä¸‰æ¨©åˆ†ç«‹ã®è¡Œæ”¿æ¨©ã‚’æ‹…ã†ã®ã¯ï¼Ÿ", options:["å›½ä¼š","å†…é–£","è£åˆ¤æ‰€","åœ°æ–¹è‡ªæ²»ä½“"], answer:1},
  {q:"æ—¥æœ¬ã®å›½ä¼šã¯è¡†è­°é™¢ã¨ä½•ã§æ§‹æˆã•ã‚Œã‚‹ï¼Ÿ", options:["å‚è­°é™¢","ä¸Šé™¢","ä¸‹é™¢","å›½å‹™é™¢"], answer:0},
  {q:"ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦å¾Œã€å›½éš›é€£åˆãŒè¨­ç«‹ã•ã‚ŒãŸå¹´ã¯ï¼Ÿ", options:["1944","1945","1946","1947"], answer:1},
  {q:"å…‰ã®åå°„ã§å…¥å°„è§’=åå°„è§’ã®æ³•å‰‡ã‚’ç™ºè¦‹ã—ãŸäººç‰©ã¯ï¼Ÿ", options:["ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³","ã‚¹ãƒãƒ«","ãƒ•ãƒƒã‚¯","ã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³"], answer:1},
  {q:"If I ___ you, I would have apologized earlier.", options:["am","was","were","be"], answer:2},
  {q:"Choose the correct sentence.", options:["Hardly I had arrived when it started raining.","Hardly had I arrived when it started raining.","I had hardly arrived when it started raining.","Hardly had I arrived it started raining."], answer:1},
  {q:"He insisted on ___ early.", options:["to leave","leaving","leave","leaved"], answer:1},
  {q:"The book, ___ was on the table, disappeared.", options:["who","whom","which","whose"], answer:2},
  {q:"No sooner ___ the train than it started raining.", options:["did he leave","he left","had he left","he had left"], answer:2},
  {q:"I wish I ___ studied harder for the exam.", options:["have","had","had had","would have"], answer:2},
  {q:"Rarely ___ such a beautiful sunset.", options:["I have seen","have I seen","I saw","I had seen"], answer:1},
  {q:"She made him ___ the report immediately.", options:["finish","finished","to finish","finishing"], answer:0},
  {q:"If it ___ for your help, I couldn't have completed it.", options:["wasn't","weren't","hadn't been","isn't"], answer:2},
  {q:"He has been working here ___ five years.", options:["since","for","from","during"], answer:1},
  {q:"ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹å®£è¨€ã¯ä½•å¹´ã«æ¡æŠã•ã‚ŒãŸï¼Ÿ", options:["1775","1776","1777","1778"], answer:1},
  {q:"ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½ã§æ¨©åŠ›ã‚’æ¡ã£ãŸäººç‰©ã¯ï¼Ÿ", options:["ãƒ«ã‚¤16ä¸–","ãƒŠãƒãƒ¬ã‚ªãƒ³","ãƒ­ãƒ™ã‚¹ãƒ”ã‚¨ãƒ¼ãƒ«","ãƒ«ã‚¤14ä¸–"], answer:2},
  {q:"ã‚¤ã‚®ãƒªã‚¹ã§ç”£æ¥­é©å‘½ãŒæœ€åˆã«å§‹ã¾ã£ãŸåˆ†é‡ã¯ï¼Ÿ", options:["ç¹Šç¶­ç”£æ¥­","é‰„é‹¼æ¥­","é€ èˆ¹æ¥­","è¾²æ¥­"], answer:0},
  {q:"å…ƒç´  Oï¼ˆé…¸ç´ ï¼‰ã¯å‘¨æœŸè¡¨ã®ä½•æ—ï¼Ÿ", options:["ãƒãƒ­ã‚²ãƒ³","å¸Œã‚¬ã‚¹","é…¸ç´ æ—","ã‚¢ãƒ«ã‚«ãƒªé‡‘å±"], answer:2},
  {q:"æ—¥æœ¬ã®æœ€é«˜è£åˆ¤æ‰€ã¯ã©ã®æ¨©åŠ›ã«å±ã™ã‚‹ï¼Ÿ", options:["ç«‹æ³•","è¡Œæ”¿","å¸æ³•","æ¤œå¯Ÿ"], answer:2},
  {q:"é«˜æ ¡ç‰©ç†ã§ã€å…‰ã¯çœŸç©ºä¸­ã§ä½•m/sã§ä¼ã‚ã‚‹ï¼Ÿ", options:["3Ã—10â¶","3Ã—10â¸","3Ã—10Â¹â°","3Ã—10Â¹Â²"], answer:1},
  {q:"é«˜æ ¡åŒ–å­¦ã§ã€æ°´é…¸åŒ–ãƒŠãƒˆãƒªã‚¦ãƒ  NaOH ã¯ä½•æ€§ï¼Ÿ", options:["é…¸æ€§","å¡©åŸºæ€§","ä¸­æ€§","é…¸åŒ–æ€§"], answer:1},
  {q:"é«˜æ ¡åœ°ç†ã§ã€æ—¥æœ¬ã®åŒ—æµ·é“åœ°æ–¹ã®æ°—å€™ã¯ï¼Ÿ", options:["äºœå¯’å¸¯æ¹¿æ½¤æ°—å€™","æ¸©æš–æ¹¿æ½¤æ°—å€™","åœ°ä¸­æµ·æ€§æ°—å€™","ç ‚æ¼ æ°—å€™"], answer:0},
  {q:"ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦å¾Œã€å†·æˆ¦ãŒå§‹ã¾ã£ãŸç†ç”±ã¯ï¼Ÿ", options:["è³‡æºäº‰å¥ª","ã‚¤ãƒ‡ã‚ªãƒ­ã‚®ãƒ¼å¯¾ç«‹","æ¤æ°‘åœ°ç²å¾—","å®—æ•™å¯¾ç«‹"], answer:1}
];

const countEl=document.getElementById('count');
const diceAreaEl=document.getElementById('dice-area');
const rollBtn=document.getElementById('rollBtn');
const eventBtn=document.getElementById('eventBtn');
const endBtn=document.getElementById('endBtn');
const decBtn=document.getElementById('dec');
const incBtn=document.getElementById('inc');
const eventCard=document.getElementById('event-card');
const eventText=document.getElementById('event-text');
const eventLabel=document.getElementById('event-label');
const turnName=document.getElementById('turn-name');

const quizModal=document.getElementById('quiz-modal');
const quizQuestion=document.getElementById('quiz-question');
const quizOptions=document.getElementById('quiz-options');
const quizResult=document.getElementById('quiz-result');
const quizOk=document.getElementById('quiz-ok');

const winnerModal=document.getElementById('winner-modal');
const winnerText=document.getElementById('winner-text');
const restartBtn=document.getElementById('restart-btn');

function updateUI(){
  countEl.textContent=diceCount;
  for(let i=0;i<players.length;i++){
    const el=document.getElementById('pl-'+(i+1));
    if(players[i].lost) el.classList.add('lost');
    else el.classList.remove('lost');
    if(i===currentPlayer) el.classList.add('current'); else el.classList.remove('current');
    let buffs=[];
    if(players[i].buff>0) buffs.push(`ğŸ² +${players[i].buff}`);
    if(players[i].reverse>0) buffs.push(`ğŸ”„${players[i].reverse}ã‚¿ãƒ¼ãƒ³é€†èµ°`);
    if(players[i].skipTurn>0) buffs.push(`â¸${players[i].skipTurn}ã‚¿ãƒ¼ãƒ³ä¼‘ã¿`);
    document.getElementById('buff-'+(i+1)).textContent=buffs.join(" / ");
    document.getElementById('plname-'+i).textContent=players[i].name;
    const totEl=document.getElementById('total-'+i);
    if(totEl) totEl.textContent=players[i].total;
    if(players[i].total <=0 && !players[i].lost){
      players[i].lost=true;
      showEventCard(`${players[i].name} ã¯æ‰€æŒé‡‘0ã§å¤±æ ¼ã«ãªã‚Šã¾ã—ãŸï¼`);
    }
  }
  turnName.textContent=players[currentPlayer].name;
  checkWinner();
}

function checkWinner(){
  const activePlayers = players.filter(p=>!p.lost);
  if(activePlayers.length===1){
    winnerText.textContent = `${activePlayers[0].name} win!!`;
    winnerModal.style.display='flex';
  }
}

restartBtn.addEventListener('click',()=>{
  players.forEach(p=>{
    p.total=1000; p.buff=0; p.skipTurn=0; p.reverse=0; p.pos=0; p.lost=false;
  });
  currentPlayer=0;
  diceCount=1;
  economyMode = 'normal'; updateEconomyDisplay(); // ãƒªã‚»ãƒƒãƒˆ
  winnerModal.style.display='none';
  updateUI();
});

function clearDice(){diceAreaEl.innerHTML='';}
function showDiceRoll(n){
  clearDice();
  // çµŒæ¸ˆçŠ¶æ³: ãƒãƒ–ãƒ«å´©å£Šã¯ã‚µã‚¤ã‚³ãƒ­-1
  let actualN = n;
  if(economyMode === 'burst') {
    actualN = Math.max(1, actualN - 1);
  }
  
  for(let i=0;i<actualN;i++){
    const num=Math.floor(Math.random()*6)+1;
    const img=document.createElement('img');
    img.src=`./dice${num}.png`;
    img.alt=`dice ${num}`;
    img.style.transform='translateY(-14px) rotate(-18deg) scale(0.92)';
    diceAreaEl.appendChild(img);
    ((el,delay)=>{setTimeout(()=>{el.style.transition='transform .45s cubic-bezier(.2,.8,.2,1)'; el.style.transform='translateY(0) rotate(0) scale(1)';}, delay);})(img,i*90);
  }
  if(economyMode === 'burst' && n > actualN) showEventCard("ãƒãƒ–ãƒ«å´©å£Šä¸­ï¼ã‚µã‚¤ã‚³ãƒ­ãŒæ¸›ã‚Šã¾ã—ãŸï¼");
}

function showEventCard(text){
  eventLabel.textContent='ã‚¤ãƒ™ãƒ³ãƒˆ';
  eventText.textContent=text;
  eventCard.classList.remove('hidden');
  clearTimeout(eventCard._timeout);
  eventCard._timeout=setTimeout(()=>eventCard.classList.add('hidden'),4000);
}

function applyEventEffect(text,p){
  if(text.includes('æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚³ãƒ­1ã¤è¿½åŠ ')) players[p].buff += 1;
  if(text.includes('3ã‚¿ãƒ¼ãƒ³é€†èµ°')) players[p].reverse=3;
  if(text.includes('æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚³ãƒ­3ã¤è¿½åŠ ')) players[p].buff += 3;
  if(text.includes('æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚³ãƒ­2ã¤è¿½åŠ ')) players[p].buff += 2;
  if(text.includes('1ã‚¿ãƒ¼ãƒ³ä¼‘ã¿')) players[p].skipTurn=1;
  const m=text.match(/([0-9]{1,7})/);
  if(text==="ã‚¯ã‚¤ã‚ºï¼"){startQuiz(p); return;}
  
  if(m){
    let num=parseInt(m[1],10); 
    
    // çµŒæ¸ˆçŠ¶æ³ã«ã‚ˆã‚‹è£œæ­£
    if(economyMode === 'inflation') {
       num *= 2; // ã‚¤ãƒ³ãƒ•ãƒ¬: 2å€
    } else if(economyMode === 'deflation') {
       num = Math.floor(num / 2); // ãƒ‡ãƒ•ãƒ¬: åŠåˆ†
    }
    
    if(text.includes('ç²å¾—')) players[p].total+=num; 
    else if(text.includes('å¤±ã†')) players[p].total-=num;
    
    if(economyMode === 'inflation') text += " (ã‚¤ãƒ³ãƒ•ãƒ¬x2!)";
    if(economyMode === 'deflation') text += " (ãƒ‡ãƒ•ãƒ¬/2...)";
  }
  updateUI();
  showEventCard(`${players[p].name} ã®ã‚¤ãƒ™ãƒ³ãƒˆ: ${text}`);
}

function startQuiz(playerIndex){
  const idx=Math.floor(Math.random()*quizzes.length);
  const quiz=quizzes[idx];
  quizQuestion.textContent=quiz.q;
  quizOptions.innerHTML='';
  quizResult.textContent='';
  quizOk.style.display='none';
  quizModal.style.display='flex';
  quiz.options.forEach((opt,i)=>{
    const btn=document.createElement('button');
    btn.textContent=opt;
    btn.onclick=()=>{
      if(i===quiz.answer){players[playerIndex].total+=1200;quizResult.textContent="æ­£è§£ï¼ï¼‹1200ï¼„";}
      else{players[playerIndex].total-=500;quizResult.textContent="ä¸æ­£è§£â€¦âˆ’500ï¼„";}
      quizOk.style.display='inline-block';
      updateUI();
    };
    quizOptions.appendChild(btn);
  });
}
quizOk.addEventListener('click',()=>{quizModal.style.display='none';});

decBtn.addEventListener('click',()=>{diceCount=Math.max(1,diceCount-1);updateUI();});
incBtn.addEventListener('click',()=>{diceCount=Math.min(10,diceCount+1);updateUI();});

rollBtn.addEventListener('click',()=>{
  const player = players[currentPlayer];
  if(player.lost){showEventCard(`${player.name} ã¯å¤±æ ¼ã®ãŸã‚æŒ¯ã‚Œã¾ã›ã‚“`); return;}
  if(player.skipTurn>0){showEventCard(`${player.name} ã¯ä¼‘ã¿ã®ãŸã‚æŒ¯ã‚Œã¾ã›ã‚“`); player.skipTurn--; updateUI(); return;}
  const totalDice=diceCount+player.buff;
  showDiceRoll(totalDice);
  let step = totalDice;
  // ãƒãƒ–ãƒ«å´©å£Šä¸­ã®ç§»å‹•ãƒšãƒŠãƒ«ãƒ†ã‚£
  if(economyMode === 'burst') step = Math.max(1, step - 1);
  
  if(player.reverse>0) step = -step;
  player.pos += step;
  player.buff=0;
  updateUI();
});

eventBtn.addEventListener('click',()=>{
  const idx=Math.floor(Math.random()*events.length);
  const text=events[idx];
  applyEventEffect(text,currentPlayer);
});

// çµŒæ¸ˆçŠ¶æ³ãƒ‡ãƒ¼ã‚¿
const economyData = {
  normal: {name:"å¹³ç©", bg:"#7bd24a", icon:"â˜€ï¸"},
  inflation: {name:"ã‚¤ãƒ³ãƒ•ãƒ¬ (é‡‘é¡2å€)", bg:"#ffeb3b", icon:"ğŸ“ˆ"},
  deflation: {name:"ãƒ‡ãƒ•ãƒ¬ (é‡‘é¡åŠæ¸›)", bg:"#cfd8dc", icon:"ğŸ“‰"},
  burst: {name:"ãƒãƒ–ãƒ«å´©å£Š (æ¯ã‚¿ãƒ¼ãƒ³10%æ²¡å)", bg:"#7b1fa2", icon:"ğŸ˜±"} // ç´«
};

function updateEconomyDisplay(){
  const w = economyData[economyMode];
  document.getElementById('economy-icon').textContent = w.icon;
  document.getElementById('economy-text').textContent = "çµŒæ¸ˆçŠ¶æ³: " + w.name;
  document.body.style.background = w.bg;
}

function checkEconomyChange(){
  // 20%ã®ç¢ºç‡ã§å¤‰å‹•
  if(Math.random() < 0.2){
    const keys = Object.keys(economyData);
    const nextKey = keys[Math.floor(Math.random() * keys.length)];
    economyMode = nextKey;
    updateEconomyDisplay();
    showEventCard(`âš ï¸ çµŒæ¸ˆçŠ¶æ³ãŒã€Œ${economyData[nextKey].name}ã€ã«å¤‰ã‚ã‚Šã¾ã—ãŸï¼`);
  }
}

function endTurn(){
  if(players[currentPlayer].reverse>0) players[currentPlayer].reverse--;
  let checked=0;
  do{
    let next = currentPlayer + 1;
    currentPlayer = next % players.length;
    checked++;
    if(checked > players.length) break;
    if(players[currentPlayer].skipTurn>0 || players[currentPlayer].lost){
      if(players[currentPlayer].skipTurn>0) showEventCard(`${players[currentPlayer].name} ã¯1ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ`);
      else if(players[currentPlayer].lost) showEventCard(`${players[currentPlayer].name} ã¯å¤±æ ¼ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ`);
      if(players[currentPlayer].skipTurn>0) players[currentPlayer].skipTurn--;
      continue;
    }
    break;
  }while(true);
  
  // ãƒãƒ–ãƒ«å´©å£Šä¸­ã®ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†
  if(economyMode === 'burst'){
     players.forEach(p => {
       if(!p.lost && p.total > 0){
         p.total = Math.floor(p.total * 0.9); // 10%æ²¡å
       }
     });
     showEventCard("ãƒãƒ–ãƒ«å´©å£Šä¸­...å…¨å“¡ã®è³‡ç”£ãŒ10%æ¶ˆæ»…ã—ã¾ã—ãŸï¼");
  }

  // çµŒæ¸ˆå¤‰å‹•ãƒã‚§ãƒƒã‚¯
  checkEconomyChange();
  
  updateUI();
}

const moneyPanel=document.querySelector('.money-panel');
for(let i=0;i<4;i++){
  const p=players[i];
  const div=document.createElement('div');
  div.className='person-money';
  div.innerHTML=`<div class="color-bar" style="background:${p.color}"></div>
  <div class="info">
  <input class="name-input" id="money-name-${i}" value="${p.name}" />
  <div class="total" id="total-${i}">${p.total}</div>
  <div class="money-buttons">
    <button data-val="-1000">-1000</button>
    <button data-val="-100">-100</button>
    <button data-val="-10">-10</button>
    <button data-val="+10">+10</button>
    <button data-val="+100">+100</button>
    <button data-val="+1000">+1000</button>
  </div>
  </div>`;
  moneyPanel.appendChild(div);

  const buttons = div.querySelectorAll('.money-buttons button');
  buttons.forEach(btn=>{
    btn.addEventListener('click',()=>{
      const val = parseInt(btn.getAttribute('data-val'),10);
      p.total += val;
      updateUI();
    });
  });
}

endBtn.addEventListener('click',endTurn);

// ---- ã‚·ãƒ§ãƒƒãƒ—æ©Ÿèƒ½ ----
const shopBtn = document.getElementById('shopBtn');
const shopModal = document.getElementById('shop-modal');
const shopList = document.getElementById('shop-list');
const shopClose = document.getElementById('shop-close');
const shopTitle = document.getElementById('shop-title');

const items = [
  {name: "ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼", cost: 400, desc: "æ¬¡ã®ã‚µã‚¤ã‚³ãƒ­ +1", effect: (p) => { p.buff += 1; }},
  {name: "ãƒ­ã‚±ãƒƒãƒˆ", cost: 1000, desc: "æ¬¡ã®ã‚µã‚¤ã‚³ãƒ­ +3", effect: (p) => { p.buff += 3; }},
  {name: "ä¸‡èƒ½è–¬", cost: 300, desc: "ä¼‘ã¿ãƒ»é€†èµ°ã‚’å›å¾©", effect: (p) => { p.skipTurn = 0; p.reverse = 0; }},
  {name: "å¦¨å®³é›»æ³¢", cost: 600, desc: "é¸ã‚“ã äººã‚’1å›ä¼‘ã¿ã«ã™ã‚‹", effect: null} 
];

function openShop(){
  const p = players[currentPlayer];
  shopTitle.textContent = "ã‚¢ã‚¤ãƒ†ãƒ ã‚·ãƒ§ãƒƒãƒ—";
  shopList.innerHTML = "";
  shopList.style.display = "grid"; 
  
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'shop-item';
    const canBuy = p.total >= item.cost;
    
    div.innerHTML = `
      <h3>${item.name}</h3>
      <p>${item.desc}</p>
      <div class="shop-price">$${item.cost}</div>
      <button class="shop-buy-btn" ${canBuy ? '' : 'disabled'}>è³¼å…¥</button>
    `;
    
    div.querySelector('button').addEventListener('click', () => {
      if(p.total >= item.cost){
        if(item.name === "å¦¨å®³é›»æ³¢"){
           showTargetSelection(p, item);
        } else {
           p.total -= item.cost;
           item.effect(p);
           showEventCard(`${p.name}ãŒ${item.name}ã‚’è³¼å…¥ã—ã¾ã—ãŸï¼`);
           updateUI();
           shopModal.style.display = 'none';
        }
      }
    });
    
    shopList.appendChild(div);
  });
  shopModal.style.display = 'flex';
}

function showTargetSelection(buyer, item){
  shopTitle.textContent = "èª°ã‚’ä¼‘ã¿ã«ã—ã¾ã™ã‹ï¼Ÿ";
  shopList.innerHTML = "";
  shopList.style.display = "flex";
  shopList.style.flexDirection = "column";

  players.forEach((target, idx) => {
    if(idx !== currentPlayer && !target.lost){
      const btn = document.createElement('button');
      btn.className = 'target-btn';
      btn.textContent = `${target.name} (ç¾åœ¨åœ°:${target.total}$)`;
      btn.onclick = () => {
        buyer.total -= item.cost;
        target.skipTurn += 1;
        showEventCard(`${buyer.name}ãŒ${item.name}ã‚’ä½¿ç”¨ï¼${target.name}ã¯1å›ä¼‘ã¿ï¼`);
        updateUI();
        shopModal.style.display = 'none';
      };
      shopList.appendChild(btn);
    }
  });

  const backBtn = document.createElement('button');
  backBtn.textContent = "æˆ»ã‚‹";
  backBtn.style.marginTop = "10px";
  backBtn.onclick = openShop; 
  shopList.appendChild(backBtn);
}

shopBtn.addEventListener('click', openShop);
shopClose.addEventListener('click', () => { shopModal.style.display = 'none'; });

updateUI();
</script>
</body>
</html>